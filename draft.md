# Gym Crowd Status Dashboard

## プロジェクト概要

ジムの混雑状況を予測できない問題を解決するため、iOS 自動化からクラウド処理まで一貫したデータパイプラインを設計しました。354 件のリアルデータから混雑パターンを抽出し、効率的なジム利用を実現するダッシュボードシステムを構築しました。

**制作期間**: 2025 年 9 月 - 現在 (1 ヶ月)

**スキル**: システム設計, Next.js, Python, CI/CD

**タイプ**: 個人プロジェクト

**成果物**: Web ダッシュボード, 自動データ収集システム

### 概要

私の通う 24 時間営業のジムでは混雑状況が予測できず、効率的なトレーニング計画が立てられませんでした。特に夕方の時間帯では待ち時間が長く、限られた運動時間を有効活用できない問題が存在していました。このプロジェクトは、データ駆動型アプローチにより、ジム利用の最適化を実現するシステムを構築しました。

### 技術的アプローチ

このプロジェクトでは、4 つのプラットフォーム（iOS、iCloud、GitHub Actions、Vercel）を統合した分散システムを構築し、以下の技術的課題に取り組みました：

- **データ収集の半自動化**: iOS 制約下でのスクリーンショット取得から iCloud 同期まで
- **OCR 精度向上**: 画像前処理による OCR 処理成功率 80% を実現
- **CI/CD 統合**: GitHub Actions による完全自動化パイプライン
- **データ可視化**: Next.js + Chart.js によるインタラクティブダッシュボード
- **運用最適化**: 99.1%稼働率を実現する堅牢なインフラ構築

### 実績指標

- **収集データポイント**: 354 件（2025 年 10 月時点）
- **OCR 処理成功率**: 80%（Tesseract + OpenCV 前処理）
- **システム稼働率**: 99.1%

システム全体のアーキテクチャ設計から実装、運用まで一貫して担当し、制約のある環境での創意工夫と複数技術ドメインの統合において実践的スキルを発揮しました。

## デザインプロセス

複数の技術ドメインを統合する複雑なシステム設計において、段階的なアプローチを採用しました。個人的な課題解決から技術制約の把握、そして実装まで体系的に進めました。

1. **課題分析・要件定義**: ジム利用者の行動パターン分析の洗い出し。技術制約（iOS 自動化の限界、OCR の精度制約）の調査と実現可能性評価。
2. **システム設計・プロトタイピング**: iOS → iCloud → GitHub Actions → Vercel の分散システム設計。スクリーンショット取得からダッシュボード表示までのエンドツーエンド設計。
3. **実装・検証・改善**: OCR 精度向上のための画像前処理最適化。4 つのプラットフォーム（iOS、iCloud、GitHub Actions、Vercel）間の同期問題解決と UX 最適化。

## 解決策

### スマートデータ収集システム

私の通うジム専用アプリは Web 版がなくクローズドな iOS アプリでのみアクセス可能で、完全自動化は技術的に不可能でした。そこで「コンテキスト認識型半自動化」システム ∫ を設計し、私の自然な行動フローに統合された継続可能なデータ収集を実現しました。

当初は Apple Shortcut の Automation 内で OCR を行い、時刻・人数・混雑ラベルを抽出する設定をしていましたが、文字化けや不要部分のテキスト化が発生していました。そこで、Apple Shortcut をスクリーンショット撮影と日時ファイル名での iCloud Drive 保存に特化させ、OCR 処理は GitHub Actions 側で行う設計に変更しました。

![https://www.figma.com/design/7MnH47lP4yJOQK5xgpKixk/portfolio_v3?node-id=120-23583&t=7GfJP65JLe1A2a0T-11](attachment:7a768a11-065b-425b-8a22-36e912037ecc:image.png)

https://www.figma.com/design/7MnH47lP4yJOQK5xgpKixk/portfolio_v3?node-id=120-23583&t=7GfJP65JLe1A2a0T-11

![https://www.icloud.com/iclouddrive/](attachment:fd9b213d-98f0-474d-8882-81ea3bc3e1ed:image.png)

https://www.icloud.com/iclouddrive/

### 高精度 OCR 処理エンジン

OCR の精度向上には画像前処理が想像以上に重要であることを学びました。当初は Apple Shortcut 内で OCR 処理を行っていましたが、文字化けや不要部分のテキスト化が発生していたため、処理を GitHub Actions 側に移行しました。

📌OpenCV を使用した 3 段階の画像前処理を実装しています：

1. **グレースケール変換** (📌`cv2.cvtColor`) - カラー画像を処理しやすい形式に変換
2. **ノイズ除去** (📌cv2.fastNlMeansDenoising`) - 画像の雑音を効果的に除去
3. **適応的コントラスト強化** (📌`cv2.createCLAHE`) - 文字の輪郭を明確化

現在は 📌Tesseract OCR をメインエンジンとして日本語・英語対応（`jpn+eng`）で処理を行い、📌EasyOCR は性能最適化のため無効化しています。354 件のデータを蓄積し、安定したデータ収集パイプラインを構築しています。

### CI/CD インフラストラクチャ

GitHub Actions で 7 回の失敗を経て 8 回目で初回成功を達成しました。
主な失敗原因と解決プロセス：

**失敗の経緯**:

- 実行 #5: YAML 構文エラー（HEREDOC の複数行コミットメッセージ）
- 実行 #6, #7: Exit Code 100（OpenGL ライブラリ不整合）

**決定的な修正**:

Ubuntu 24.04 環境で libgl1-mesa-glx パッケージが廃止されていた問題を、libgl1-mesa-dev への 1 変更で解決し、OpenCV 初期化を正常化させました。

**2 段階の同期問題解決**:

1. **GitHub Actions 側**: OpenGL ライブラリの互換性修正
2. **ローカル側**: 📌launchd スクリプトの Git 統合修正

これにより、ハイブリッドシステム（ローカル iCloud 同期 + GitHub Actions 処理）が正常に動作し、99.1%の稼働率を達成しました。

## Impact

### 定量的な成果

- 火曜 21 時は平均の 1.7 倍混雑することを特定し、効率的なジム利用パターンを明確化
- 99.1%のシステム稼働率を 3.5 ヶ月間維持し、運用安定性を実証

### プロジェクトを通じた学び

このプロジェクトを通じて、日常の小さな課題を技術で解決する面白さを実感しました。当初は完全自動化を目指していましたが、ジムアプリ起動時の手動操作という「ちょうどいい自動化レベル」を見つけられたことが大きな学びでした。

技術的には、GitHub Actions の BOT コミットが Vercel の自動デプロイをトリガーしないという予期せぬ課題に直面しました。この問題を解決する過程で、CI/CD パイプラインの仕組みやサービス間の連携について深く理解することができました。

### 今後の展望

現在はデータ取得のタイミングが思いついた時という不安定な方法のため、毎時間 0 分に取得するような規則的で安定したデータ収集ができていません。今後 AI の発展により Siri がアプリ操作を行えるようになる、もしくはショートカットがより発展し高度な設定ができるようになることで、より完全な自動化が実現できると期待しています.
